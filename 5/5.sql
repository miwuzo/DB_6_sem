INSERT INTO Warehouses (Name, Address, Area, ContactInfo, Type, Location) VALUES
('Центральный склад', 'г. Москва, ул. Промышленная, 15', 2500.5, '+7 (495) 123-45-67', 'Общего назначения', geometry::Point(37.6178, 55.7512, 4326)),
('Северный распределительный центр', 'г. Санкт-Петербург, ш. Выборгское, 45', 1800.0, '+7 (812) 987-65-43', 'Холодильный', geometry::Point(30.3351, 59.9343, 4326)),
('Южный логистический комплекс', 'г. Ростов-на-Дону, пр. Стачки, 123', 3200.75, '+7 (863) 456-78-90', 'Отапливаемый', geometry::Point(39.7231, 47.2224, 4326)),
('Восточный терминал', 'г. Екатеринбург, ул. Магистральная, 67', 1500.25, '+7 (343) 345-67-89', 'Сортировочный', geometry::Point(60.5975, 56.8389, 4326)),
('Западный склад', 'г. Калининград, ул. Портовое шоссе, 12', 950.0, '+7 (4012) 34-56-78', 'Морской терминал', geometry::Point(20.5114, 54.7104, 4326)),
('Склад №6', 'г. Новосибирск, ул. Логистическая, 8', 2100.0, '+7 (383) 123-45-67', 'Автоматизированный', geometry::Point(82.9204, 55.0084, 4326)),
('Фулфилмент центр', 'г. Казань, пр. Победы, 141', 2750.5, '+7 (843) 987-65-43', 'Электронной коммерции', geometry::Point(49.1088, 55.8304, 4326)),
('Агросклад', 'г. Краснодар, ул. Зерновая, 33', 1850.0, '+7 (861) 234-56-78', 'Сельскохозяйственный', geometry::Point(38.9750, 45.0355, 4326)),
('Фармацевтический склад', 'г. Воронеж, ул. Медицинская, 5', 1200.75, '+7 (473) 345-67-89', 'Фармацевтический', geometry::Point(39.2003, 51.6606, 4326)),
('Опасные грузы', 'г. Самара, промзона "Восток", стр. 7', 800.0, '+7 (846) 456-78-90', 'Опасные материалы', geometry::Point(50.1018, 53.1959, 4326));


INSERT INTO Positions (Name, Description, AccessLevel, WarehouseID, IsActive) VALUES
('Управляющий складом', 'Руководство всеми операциями склада', 5, 1, 1),
('Старший кладовщик', 'Контроль работы кладовщиков, приемка товара', 4, 1, 1),
('Кладовщик', 'Прием, хранение и отпуск товара', 3, 1, 1),
('Грузчик', 'Погрузочно-разгрузочные работы', 2, 1, 1),
('Оператор ПК', 'Ведение учета в системе WMS', 3, 1, 1),
('Логист', 'Планирование перемещений товара', 4, NULL, 1),
('Менеджер по запасам', 'Контроль остатков, заказы поставщикам', 4, NULL, 1),
('Администратор системы', 'Обслуживание складского ПО', 5, NULL, 1),
('Управляющий холодильным складом', 'Специализированное управление холодильным складом', 5, 2, 1),
('Оператор холодильного оборудования', 'Обслуживание холодильных установок', 3, 2, 1),
('Водитель погрузчика', 'Работа на складской технике', 3, 3, 1),
('Маркировщик', 'Маркировка и упаковка товаров', 2, 3, 1),
('Контролер качества', 'Проверка качества поступающего товара', 3, 4, 1),
('Специалист по опасным грузам', 'Работа с опасными материалами', 4, 10, 1),
('Фармацевт-кладовщик', 'Специалист по хранению лекарств', 4, 9, 1);

select * from positions
select * from Warehouses
INSERT INTO Employees (FullName, PositionID, WarehouseID, ContactInfo, Status) VALUES
('Иванов Сергей Петрович', 95, 2, '+7 (916) 123-45-67', 'active'),
('Петрова Анна Владимировна', 96, 2, '+7 (926) 234-56-78', 'active'),
('Сидоров Михаил Игоревич', 97, 3, '+7 (903) 345-67-89', 'active'),
('Кузнецова Елена Дмитриевна', 98, 3, '+7 (967) 456-78-90', 'active'),
('Васильев Андрей Сергеевич', 99, 4, '+7 (905) 567-89-01', 'active'),
('Николаев Денис Олегович', 100, 10, '+7 (916) 678-90-12', 'active'),
('Смирнова Ольга Александровна', 101, 9, '+7 (926) 789-01-23', 'active'),
('Федоров Иван Васильевич', 95, 2, '+7 (903) 890-12-34', 'active'),
('Алексеева Татьяна Николаевна', 96, 2, '+7 (967) 901-23-45', 'active'),
('Громов Павел Андреевич', 97, 3, '+7 (905) 012-34-56', 'active'),
('Белов Алексей Дмитриевич', 98, 3, '+7 (916) 123-45-67', 'active'),
('Ковалева Марина Сергеевна', 99, 4, '+7 (926) 234-56-78', 'active'),
('Орлов Дмитрий Викторович', 100, 10, '+7 (903) 345-67-89', 'active'),
('Лебедева Ирина Анатольевна', 101, 9, '+7 (967) 456-78-90', 'active'),
('Соколов Артем Валерьевич', 95, 2, '+7 (905) 567-89-01', 'active'),
('Волкова Наталья Игоревна', 96, 2, '+7 (916) 678-90-12', 'active'),
('Козлов Владимир Александрович', 97, 3, '+7 (926) 789-01-23', 'active'),
('Новикова Екатерина Сергеевна', 98, 3, '+7 (903) 890-12-34', 'active'),
('Морозов Антон Павлович', 99, 4, '+7 (967) 901-23-45', 'active'),
('Павлова Светлана Викторовна', 100, 10, '+7 (905) 012-34-56', 'active'),
('Семенов Игорь Николаевич', 101, 9, '+7 (916) 123-45-67', 'active'),
('Михайлова Юлия Андреевна', 95, 2, '+7 (926) 234-56-78', 'active'),
('Тарасов Роман Олегович', 96, 2, '+7 (903) 345-67-89', 'active'),
('Филиппова Анастасия Дмитриевна', 97, 3, '+7 (967) 456-78-90', 'active'),
('Данилов Артем Сергеевич', 98, 3, '+7 (905) 567-89-01', 'active'),
('Савельева Елена Владимировна', 99, 4, '+7 (916) 678-90-12', 'active'),
('Григорьев Максим Игоревич', 100, 10, '+7 (926) 789-01-23', 'active'),
('Титова Анна Павловна', 101, 9, '+7 (903) 890-12-34', 'active'),
('Комарова Виктория Александровна', 99, 4, '+7 (967) 901-23-45', 'active'),
('Борисов Денис Валерьевич', 99, 4, '+7 (905) 012-34-56', 'active');


INSERT INTO Products (Name, Article, Description, MeasurementUnit, Price) VALUES
('Ноутбук ASUS X515', 'NB-ASUS-X515', '15.6", Intel Core i5, 8GB RAM, 512GB SSD', 'шт.', 54990.00),
('Смартфон Samsung Galaxy A53', 'PH-SM-A53', '6.5", 128GB, 5G, черный', 'шт.', 32990.00),
('Холодильник Beko RCNA400K20W', 'FR-BEKO-RCNA400', 'No Frost, 395 л, белый', 'шт.', 45990.00),
('Кофе в зернах Lavazza Qualita Oro', 'CF-LV-QORO', '250 г, 100% арабика', 'кг', 890.00),
('Машинное масло Mobil Super 3000', 'OIL-MOB-SUPER3K', '5W-40, 5 л', 'л', 3200.00),
('Плитка шоколада "Аленка"', 'CH-ALENKA', 'Молочный шоколад, 100 г', 'шт.', 65.00),
('Кроссовки Nike Air Max', 'SH-NIKE-AIRMAX', 'Мужские, размер 42, черные', 'пара', 8990.00),
('Чай Greenfield "Golden Ceylon"', 'TEA-GF-GCEYLON', '100 пакетиков, черный', 'уп.', 450.00),
('Стиральная машина LG F2J3NS0W', 'WM-LG-F2J3NS0W', '6 кг, фронтальная, белая', 'шт.', 32990.00),
('Наушники Sony WH-1000XM4', 'HP-SONY-WHXM4', 'Беспроводные, с шумоподавлением', 'шт.', 24990.00),
('Молоко "Домик в деревне" 3.2%', 'MLK-DOMIK-3.2', 'Ультрапастеризованное, 1 л', 'л', 95.00),
('Пылесос Philips PowerPro Compact', 'VAC-PH-PPC', 'Мощность 650 Вт, мешок 2 л', 'шт.', 7990.00),
('Гречневая крупа "Мистраль"', 'GRC-MISTRAL', 'Высший сорт, 800 г', 'кг', 120.00),
('Телевизор LG 43UP75006LF', 'TV-LG-43UP750', '43", 4K UHD, Smart TV', 'шт.', 42990.00),
('Мыло туалетное "Dove"', 'SOAP-DOVE', 'Увлажняющее, 100 г', 'шт.', 65.00),
('Батарейки Duracell AA', 'BAT-DUR-AA', 'Щелочные, 4 шт в упаковке', 'уп.', 350.00),
('Лампа светодиодная Gauss', 'LMP-GAUSS', 'E27, 10W, 3000K, теплый свет', 'шт.', 250.00),
('Вода минеральная "Evian"', 'WTR-EVIAN', '1.5 л, стеклянная бутылка', 'шт.', 290.00),
('Кресло офисное "Bureaucrat"', 'CHAIR-BUREAU', 'Кожаное, черное, с подголовником', 'шт.', 15990.00),
('Флешка SanDisk Ultra 64GB', 'USB-SD-ULTRA64', 'USB 3.0, скорость до 150 МБ/с', 'шт.', 990.00);


INSERT INTO Receipts (Date, Supplier, InvoiceNumber, WarehouseID, Total) VALUES
('2024-03-05', 'ООО "Пример"', 'ТП-230305-005', 13, 1100000.00),
('2024-03-12', 'АО "ЭлектроникаПлюс"', 'ЭП-230312-049', 13, 920000.00),
('2024-04-08', 'ИП Смирнов А.А.', 'СМ-230408-016', 13, 350000.00),
('2024-04-15', 'ООО "Бытовые решения"', 'БР-230415-082', 13, 580000.00),
('2024-05-03', 'ЗАО "Продукты питания"', 'ПП-230503-037', 13, 225000.00),
('2024-05-18', 'ООО "ТехноПоставка"', 'ТП-230518-006', 13, 950000.00),
('2024-06-07', 'АО "ЭлектроникаПлюс"', 'ЭП-230607-050', 13, 810000.00),
('2024-06-14', 'ИП Смирнов А.А.', 'СМ-230614-017', 13, 390000.00),
('2024-07-09', 'ООО "Бытовые решения"', 'БР-230709-083', 13, 620000.00),
('2024-07-22', 'ЗАО "Продукты питания"', 'ПП-230722-038', 13, 255000.00),
('2024-08-11', 'ООО "ТехноПоставка"', 'ТП-230811-007', 13, 1020000.00),
('2024-08-25', 'АО "ЭлектроникаПлюс"', 'ЭП-230825-051', 13, 880000.00),
('2024-09-06', 'ИП Смирнов А.А.', 'СМ-230906-018', 13, 420000.00),
('2024-09-19', 'ООО "Бытовые решения"', 'БР-230919-084', 13, 590000.00),
('2024-10-05', 'ЗАО "Продукты питания"', 'ПП-231005-039', 13, 230000.00),
('2024-10-16', 'ООО "ТехноПоставка"', 'ТП-231016-008', 13, 970000.00),
('2024-11-07', 'АО "ЭлектроникаПлюс"', 'ЭП-231107-052', 13, 830000.00),
('2024-11-14', 'ИП Смирнов А.А.', 'СМ-231114-019', 13, 440000.00),
('2024-12-03', 'ООО "Бытовые решения"', 'БР-231203-085', 13, 650000.00),
('2024-12-18', 'ЗАО "Продукты питания"', 'ПП-231218-040', 13, 265000.00),
('2024-02-10', 'ООО "ТехноПоставка"', 'ТП-230210-009', 13, 890000.00),
('2024-02-17', 'АО "ЭлектроникаПлюс"', 'ЭП-230217-053', 13, 720000.00),
('2024-03-22', 'ИП Смирнов А.А.', 'СМ-230322-020', 13, 470000.00),
('2024-04-28', 'ООО "Бытовые решения"', 'БР-230428-086', 13, 530000.00),
('2024-05-30', 'ЗАО "Продукты питания"', 'ПП-230530-041', 13, 215000.00);



INSERT INTO Shipments (Date, Client, InvoiceNumber, WarehouseID, Total) VALUES
('2024-03-05', 'ООО "Розничная сеть"', 'РС-230305-105', 13, 980000.00),
('2024-03-12', 'ИП Козлов В.В.', 'КЗ-230312-025', 13, 320000.00),
('2024-04-08', 'АО "Торговый дом"', 'ТД-230408-049', 13, 540000.00),
('2024-04-15', 'ООО "Техномаркет"', 'ТМ-230415-036', 13, 210000.00),
('2024-05-03', 'ИП Николаева С.И.', 'НК-230503-015', 13, 980000.00),
('2024-05-18', 'ООО "Розничная сеть"', 'РС-230518-106', 13, 760000.00),
('2024-06-07', 'ИП Козлов В.В.', 'КЗ-230607-026', 13, 430000.00),
('2024-06-14', 'АО "Торговый дом"', 'ТД-230614-050', 13, 670000.00),
('2024-07-09', 'ООО "Техномаркет"', 'ТМ-230709-037', 13, 290000.00),
('2024-07-22', 'ИП Николаева С.И.', 'НК-230722-016', 13, 1150000.00),
('2024-08-11', 'ООО "Розничная сеть"', 'РС-230811-107', 13, 820000.00),
('2024-08-25', 'ИП Козлов В.В.', 'КЗ-230825-027', 13, 380000.00),
('2024-09-06', 'АО "Торговый дом"', 'ТД-230906-051', 13, 510000.00),
('2024-09-19', 'ООО "Техномаркет"', 'ТМ-230919-038', 13, 240000.00),
('2024-10-05', 'ИП Николаева С.И.', 'НК-231005-017', 13, 1050000.00),
('2024-10-16', 'ООО "Розничная сеть"', 'РС-231016-108', 13, 790000.00),
('2024-11-07', 'ИП Козлов В.В.', 'КЗ-231107-028', 13, 410000.00),
('2024-11-14', 'АО "Торговый дом"', 'ТД-231114-052', 13, 630000.00),
('2024-12-03', 'ООО "Техномаркет"', 'ТМ-231203-039', 13, 270000.00),
('2024-12-18', 'ИП Николаева С.И.', 'НК-231218-018', 13, 890000.00),
('2024-02-10', 'ООО "Розничная сеть"', 'РС-230210-109', 13, 950000.00),
('2024-02-17', 'ИП Козлов В.В.', 'КЗ-230217-029', 13, 370000.00),
('2024-03-22', 'АО "Торговый дом"', 'ТД-230322-053', 13, 520000.00),
('2024-04-28', 'ООО "Техномаркет"', 'ТМ-230428-040', 13, 220000.00),
('2024-05-30', 'ИП Николаева С.И.', 'НК-230530-019', 13, 1070000.00);



-----------3

	SELECT
    FORMAT(Date, 'yyyy-MM') AS month,
    SUM(Total) AS monthly_total,
    SUM(SUM(Total)) OVER (PARTITION BY YEAR(Date), DATEPART(QUARTER, Date)) AS quarterly_total,
    SUM(SUM(Total)) OVER (PARTITION BY YEAR(Date), 
        CASE 
            WHEN MONTH(Date) <= 6 THEN 'First Half' 
            ELSE 'Second Half' 
        END) AS half_year_total,
    SUM(SUM(Total)) OVER (PARTITION BY YEAR(Date)) AS yearly_total
FROM
    Receipts
WHERE
    WarehouseID = 13
GROUP BY
    FORMAT(Date, 'yyyy-MM'), 
    YEAR(Date), 
    DATEPART(QUARTER, Date),
    CASE 
        WHEN MONTH(Date) <= 6 THEN 'First Half' 
        ELSE 'Second Half' 
    END
ORDER BY
    month;


-----------4

	SELECT
    Supplier,
    SUM(Total) AS TotalSales,
    SUM(Total) * 100.0 / SUM(SUM(Total)) OVER () AS SalesPercentageOfTotal, -- OVER() суммирует все групповые суммы - все стрроки рез-та
    SUM(Total) * 100.0 / MAX(SUM(Total)) OVER () AS SalesPercentageOfBest
FROM 
    Receipts
GROUP BY 
    Supplier;




-----------5
DECLARE @PageNumber INT = 1; -- Номер страницы
DECLARE @PageSize INT = 20;  

SELECT *
FROM
  (
    SELECT *, ROW_NUMBER() OVER (ORDER BY Name) AS RowNum
    FROM Products
  ) AS SubQuery
WHERE RowNum BETWEEN (@PageNumber - 1) * @PageSize + 1 AND @PageNumber * @PageSize;



-----------6
--нумер нач заново для каждого уникального значения в столбце Name
WITH RankedProducts AS (
    SELECT 
        *,
        ROW_NUMBER() OVER (PARTITION BY Name ORDER BY Article) AS RowNum
    FROM 
        Products
)

SELECT Name, Article, Description, MeasurementUnit, Price
FROM RankedProducts
WHERE RowNum = 1;  -- Оставляем только первый экземпляр для каждого уникального товара



-----------7
SELECT 
    W.ID, 
    W.Name AS WarehouseName, 
    W.Address, 
    DATEPART(YEAR, R.Date) AS Year, 
    DATEPART(MONTH, R.Date) AS Month, 
    COUNT(*) AS ReceiptCount
FROM 
    Warehouses W
INNER JOIN 
    Receipts R ON W.ID = R.WarehouseID
WHERE 
    R.Date >= DATEADD(MONTH, -6, GETDATE())
GROUP BY 
    W.ID, W.Name, W.Address, DATEPART(YEAR, R.Date), DATEPART(MONTH, R.Date);


-----------4
	SELECT 
    w.ID AS WarehouseID,
    w.Name AS WarehouseName,
    COUNT(e.ID) AS EmployeeCount,
    CASE 
        WHEN RANK() OVER (ORDER BY COUNT(e.ID) DESC) = 1 THEN 'С наибольшим количеством сотрудников'
        ELSE 'Обычный склад'
    END AS WarehouseStatus
FROM 
    Warehouses w
LEFT JOIN 
    Employees e ON w.ID = e.WarehouseID
GROUP BY 
    w.ID, w.Name
HAVING 
    COUNT(e.ID) > 0
ORDER BY 
    EmployeeCount DESC;